<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">

<dom-module id="element-always-on-top">
  <template>
    <style>
      paper-toggle-button {
        cursor: pointer;
        --paper-toggle-button-checked-bar-color:  var(--paper-green-500);
        --paper-toggle-button-checked-button-color:  var(--paper-green-500);
        --paper-toggle-button-checked-ink-color: var(--paper-green-500);
        --paper-toggle-button-unchecked-bar-color:  var(--paper-pink-500);
        --paper-toggle-button-unchecked-button-color:  var(--paper-pink-500);
        --paper-toggle-button-unchecked-ink-color: var(--paper-pink-500);
      }
    </style>
    <paper-toggle-button id="paperToggleEnable" title="{{label}}"></paper-toggle-button>
  </template>

  <script>
      class ElementAlwayOnTop extends Polymer.Element {

          static get is() {
              return 'element-always-on-top';
          }

          // Declare properties for the element's public API
          static get properties() {
              return {
                  label : {
                      type: String
                  }
              }
          }

          ready() {
              super.ready();

              require('electron').ipcRenderer.on('enable-always-on-top', this._enableAtop.bind(this));
              require('electron').ipcRenderer.on('disable-always-on-top', this._disableAtop.bind(this));

              this.$.paperToggleEnable.addEventListener('change', this._change.bind(this));
              this.$.paperToggleEnable.checked = serviceManager.get('Config').dashboard.alwaysOnTop;
              // TODO DEFAULT
          }

          /**
           * @param evt
           * @param msg
           * @private
           */
          _enableAtop(evt, msg) {
              if (msg && msg.context !== 'dashboard') {
                  return;
              }

              this.$.paperToggleEnable.checked = true;
              this.label = 'Always on top enable';
          }

          /**
           * @param evt
           * @param msg
           * @private
           */
          _disableAtop(evt, msg) {
              if (msg && msg.context !== 'dashboard') {
                  return;
              }

              this.$.paperToggleEnable.checked = false;
              this.label = 'Always on top disable';
          }

          /**
           * @param evt
           * @private
           */
          _change(evt) {

              require('electron').ipcRenderer.send(
                  'toggle-always-on-top',
                  {
                      context: 'dashboard',
                      status: evt.target.checked === true ? 'enable' : 'disable'
                  });
          }
      }

      window.customElements.define(ElementAlwayOnTop.is, ElementAlwayOnTop);
  </script>
</dom-module>
