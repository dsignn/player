<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">

<dom-module id="element-always-on-top">
  <template>
    <style>
      paper-toggle-button {
        cursor: pointer;
        --paper-toggle-button-checked-bar-color:  var(--paper-green-500);
        --paper-toggle-button-checked-button-color:  var(--paper-green-500);
        --paper-toggle-button-checked-ink-color: var(--paper-green-500);
        --paper-toggle-button-unchecked-bar-color:  var(--paper-pink-500);
        --paper-toggle-button-unchecked-button-color:  var(--paper-pink-500);
        --paper-toggle-button-unchecked-ink-color: var(--paper-pink-500);
      }
    </style>
    <paper-toggle-button id="paperToggleEnable" title="{{label}}" checked="{{value}}"></paper-toggle-button>
  </template>

  <script>
      class ElementAlwayOnTop extends Polymer.Element {

          static  get DASHBOARD() { return "dashboard"; };

          static  get MONITOR() { return "monitor"; };

          static get is() {
              return 'element-always-on-top';
          }

          // Declare properties for the element's public API
          static get properties() {
              return {
                  label : {
                      type: String
                  },

                  context : {
                      type: String
                  },

                  monitor : {
                      type: Object
                  },

                  value : {
                      type: Boolean,
                      notify: true,

                  }
              }
          }

          ready() {
              super.ready();

              require('electron').ipcRenderer.on('enable-always-on-top', this._enableAtop.bind(this));
              require('electron').ipcRenderer.on('disable-always-on-top', this._disableAtop.bind(this));

              this.$.paperToggleEnable.addEventListener('change', this._change.bind(this));

             switch (this.context) {
                 case ElementAlwayOnTop.DASHBOARD:
                     this.$.paperToggleEnable.checked = serviceManager.get('Config').dashboard.alwaysOnTop;
                     break;
             }
              this._setLabelFromChecker(this.$.paperToggleEnable.checked);
          }

          /**
           * @param evt
           * @param msg
           * @private
           */
          _enableAtop(evt, msg) {
              if (msg && msg.context !== this.context) {
                  return;
              }

              if (this.monitor && msg.context !== ElementAlwayOnTop.MONITOR && msg.monitorId !== this.monitor.id) {
                  return;
              }

              this.$.paperToggleEnable.checked = true;
              this.label = 'Always on top enable';
          }

          /**
           * @param evt
           * @param msg
           * @private
           */
          _disableAtop(evt, msg) {
              if (msg && msg.context !== this.context) {
                  return;
              }

              if (this.monitor && msg.context !== ElementAlwayOnTop.MONITOR && msg.monitorId !== this.monitor.id) {
                  return;
              }

              this.$.paperToggleEnable.checked = false;
              this.label = 'Always on top disable';
          }

          /**
           * @param evt
           * @private
           */
          _change(evt) {
              this._setLabelFromChecker(evt.target.checked);
              require('electron').ipcRenderer.send(
                  'toggle-always-on-top',
                  {
                      context: this.context,
                      status: evt.target.checked === true ? 'enable' : 'disable',
                      monitorId : this.monitor ? this.monitor.id : null
                  });
          }

          /**
           * @param checker
           * @private
           */
          _setLabelFromChecker(checker) {
              this.label = checker ? 'Always on top enable' : 'Always on top disable';
          }
      }

      window.customElements.define(ElementAlwayOnTop.is, ElementAlwayOnTop);
  </script>
</dom-module>
