<link rel="import" href="storage-adapter-behaviour.html">

<dom-module id="storage-adapter-list-resource-behaviour">
    <script>
        class StorageAdapterPaginationResourceBehaviour extends StorageAdapterBehaviour {

            static get is() {
                return 'storage-adapter-resource-behaviour';
            }

            static get properties() {
                return {

                    resources: {
                        type: Array,
                        notify: true
                    },

                    page: {
                        type: Number,
                        value: 1
                    },

                    itemPerPage: {
                        type: Number,
                        value: 20
                    },

                    totalItems: {
                        type: Number,
                        readOnly: true,
                        value: 0
                    },
                }
            }

            ready() {
                super.ready();
            }

            static get observers() {
                return [
                    '_pagedResources(page, itemPerPage, storage)'
                ]
            }

            /**
             * @param page
             * @param itemPerPage
             * @param storage
             * @private
             */
            _pagedResources(page, itemPerPage, storage) {
                if (page === undefined || itemPerPage === undefined || storage === undefined) {
                    return;
                }

                this.getResources();
            }

            /**
             *
             */
            getResources() {
                // TODO add filter
                this.storage.getPaged(this.page, this.itemPerPage)
                    .then((data) => {
                        this.set('resources', data);
                        this._setTotalItems(data.totalItems);
                    });
            }

            /**
             * @return string
             */
            getStoragePersistMethod() {
                return this.resource.id ? 'update' : 'save';
            }

            /**
             * @param evt
             */
            _removeResource(evt) {

                let index = null;
                this.resources.find((element, ind) => {
                    if (element.id === evt.detail.id) {
                        index = ind;
                        return element;
                    }
                });

                this.splice('resources', index, 1);

                this.storage.remove(evt.detail)
                    .then((data) => {

                    });
            }
        }
    </script>
</dom-module>
